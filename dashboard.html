<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Dashboard | CPMS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    html {
      scroll-behavior: smooth;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", sans-serif;
    }

    body {
      background-color: #f9f9f9;
      color: #fff;
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background-color: #1a237e;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 0;
      position: fixed;
      height: 100%;
      left: 0;
      top: 0;
      transition: left 0.3s ease;
      z-index: 100;
    }

    .logo {
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      color: white;
      margin-bottom: 30px;
    }

    .nav-links {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 0 25px;
    }

    .nav-links a {
      text-decoration: none;
      color: #fff;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: 0.2s;
      padding: 12px 20px;
      border-radius: 8px;
    }

    .nav-links a:hover {
      background: #283593;
    }

    .logout-btn {
      margin: 20px;
      padding: 10px;
      background-color: #fff;
      color: #1a237e;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    .logout-btn:hover {
      background-color: blue;
      color: #fff;
    }

    /* Main area */
    .main {
      margin-left: 240px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: 0.3s;
    }

    /* Top Navbar */
    .topbar {
      background-color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .menu-toggle {
      display: none;
      font-size: 22px;
      color: #1a237e;
      cursor: pointer;
    }

    .topbar h2 {
      color: #1a237e;
      font-size: 20px;
      margin-left: 10px;
    }

    .top-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .notification {
      position: relative;
      font-size: 20px;
      color: #1a237e;
      cursor: pointer;
    }

    .user-info {
      line-height: 1.6;
      font-size: 15px;
    }

    .user-info p {
      margin: 4px 0;
      color: #1a237e;
    }

    .user-info strong {
      width: 80px;
      display: inline-block;
    }

    .user-info span {
      font-weight: 600;
      color: #1a237e;
    }

    /* Welcome Card */
    .welcome-card {
      background-color: #fff;
      border-radius: 12px;
      padding: 25px;
      margin: 25px auto;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      text-align: center;
    }

    .welcome-card h3 {
      color: #1a237e;
      margin-bottom: 8px;
    }

    .welcome-card p {
      color: #1a237e;
    }

    /* Courses Section */
    .courses-section {
      padding: 20px 30px;
      color: #333;
    }

    .courses-section h3 {
      margin-bottom: 20px;
      color: #1a237e;
      text-align: left;
    }

    .courses-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .course-card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 20px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .course-card:hover {
      transform: translateY(-5px);
    }

    .course-card h4 {
      color: #333;
      margin-bottom: 10px;
    }

    .course-card button {
      background-color: #1a237e;
      border: none;
      color: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .course-card button:hover {
      background-color: #283593;
    }

    /* Progress Section */
    .progress-section {
      padding: 20px 30px;
      margin-bottom: 30px;
    }

    .progress-section h3 {
      color: #1a237e;
      text-align: center;
      margin-bottom: 15px;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background-color: #fff;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      background-color: #1a237e;
      color: #fff;
      height: 100%;
      width: 0%;
      text-align: center;
      line-height: 20px;
      border-radius: 10px;
      font-size: 12px;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      max-height: 70vh;
      overflow-y: auto;
      text-align: left;
    }

    .modal-content h3 {
      color: #1a237e;
    }

    .close {
      float: right;
      font-size: 20px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .menu-toggle {
        display: block;
      }

      .sidebar {
        left: -250px;
      }

      .sidebar.active {
        left: 0;
      }

      .main {
        margin-left: 0;
      }

      .topbar h2 {
        flex: 1;
        text-align: center;
        font-size: small;
      }

      .top-actions {
        gap: 8px;
      }

      .user-info p {
        font-size: 12px;
      }
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">[Logo Here]</div>
    <nav class="nav-links">
      <a href="#welcome-section" class="active"><i class="fa-solid fa-house"></i><span>Dashboard</span></a>
      <a href="#courses-section"><i class="fa-solid fa-book"></i><span>Courses</span></a>
      <a href="#progress-section"><i class="fa-solid fa-clipboard-list"></i><span>Progress</span></a>
    </nav>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </aside>

  <!-- Main Section -->
  <div class="main">
    <!-- Topbar -->
    <div class="topbar">
      <div class="menu-toggle" id="menuToggle">
        <i class="fa-solid fa-bars"></i>
      </div>
      <h2>Student Dashboard</h2>
      <div class="top-actions">
        <i id="feedbackIcon" class="fa-solid fa-bell notification"></i>
        <div class="user-info">
          <p><strong>Name</strong>: <span id="studentName"></span></p>
          <p><strong>Adm No</strong>: <span id="admissionNo"></span></p>
          <p><strong>Course</strong>: <span id="course"></span></p>
        </div>
      </div>
    </div>

    <!-- Welcome Card -->
    <div id="welcome-section" class="welcome-card">
      <h3>Welcome Back, <span id="studentName2"></span>!</h3>
      <p id="currentDate"></p>
    </div>

    <!-- Courses Section -->
    <section id="courses-section" class="courses-section">
      <h3>ðŸŽ“ Choose Your Course To View Tasks/Projects</h3>
      <div id="coursesContainer" class="courses-container"></div>
    </section>

    <!-- Progress Section -->
    <section id="progress-section" class="progress-section">
      <h3>Task Progress Tracker</h3>
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill">0%</div>
      </div>
    </section>
  </div>

  <!-- Feedback Modal -->
  <div id="feedbackModal" class="modal hidden">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h3>Supervisor Feedback</h3>
      <ul id="feedbackList"></ul>
    </div>
  </div>

  <script>
    // ðŸŸ¢ Check login status
    const student = JSON.parse(localStorage.getItem("cpms_user"));
    if (!student) window.location.href = "student-login.html";

    // Display student info
    document.getElementById("studentName").textContent = student.name;
    document.getElementById("studentName2").textContent = student.name;
    document.getElementById("admissionNo").textContent = student.admission_no;
    document.getElementById("course").textContent = student.course;

    // Display date
    document.getElementById("currentDate").textContent = new Date().toDateString();

    // ðŸŸ¢ Logout
    document.getElementById("logoutBtn").onclick = () => {
      window.location.href = "student-login.html";
    };

    // ðŸŸ¢ Courses
    const coursesContainer = document.getElementById("coursesContainer");
    const courses = [
      { name: "Information Technology" },
      { name: "Networking" },
      { name: "Software Engineering" },
      { name: "Business Management" },
      { name: "Electrical Engineering" },
      { name: "Computer Science" },
      { name: "Cyber Security" },
      { name: "Artificial Intelligence" }
    ];

    courses.forEach(course => {
      const card = document.createElement("div");
      card.className = "course-card";
      card.innerHTML = `
        <h4>${course.name}</h4>
        <p>All tasks and projects of this course</p>
        <button onclick="viewTasks('${course.name}')">View</button>
      `;
      coursesContainer.appendChild(card);
    });

    function viewTasks(courseName) {
      localStorage.setItem("selected_course", courseName);
      window.location.href = "student-tasks.html";
    }

    // ðŸŸ¢ Feedback Modal
    const modal = document.getElementById("feedbackModal");
    const feedbackList = document.getElementById("feedbackList");
    const feedbackIcon = document.getElementById("feedbackIcon");
    const closeModal = document.getElementById("closeModal");

    feedbackIcon.onclick = async () => {
      modal.classList.remove("hidden");
      feedbackList.innerHTML = "<li>Loading...</li>";
      try {
        const res = await fetch(`http://localhost/cpms-api/feedback/get_feedback.php?student_id=${student.id}`);
        const data = await res.json();
        if (data.success && data.feedbacks.length > 0) {
          feedbackList.innerHTML = data.feedbacks.map(f => `<li><strong>${f.date_sent}:</strong> ${f.feedback_text}</li>`).join("");
        } else {
          feedbackList.innerHTML = "<li>No feedback available.</li>";
        }
      } catch (err) {
        feedbackList.innerHTML = "<li>Failed to load feedbacks.</li>";
      }
    };

    closeModal.onclick = () => modal.classList.add("hidden");
    window.onclick = e => { if (e.target === modal) modal.classList.add("hidden"); };

    // ðŸŸ¢ Sidebar Toggle for mobile
    const sidebar = document.querySelector(".sidebar");
    const menuToggle = document.getElementById("menuToggle");

    menuToggle.onclick = () => {
      sidebar.classList.toggle("active");
    };

    document.addEventListener("click", (e) => {
      if (
        !sidebar.contains(e.target) &&
        !menuToggle.contains(e.target) &&
        window.innerWidth <= 768
      ) {
        sidebar.classList.remove("active");
      }
    });

    // ðŸŸ¢ Progress Tracker (demo)
    let progress = 0;
    const progressFill = document.getElementById("progressFill");
    const interval = setInterval(() => {
      if (progress < 75) {
        progress += 1;
        progressFill.style.width = progress + "%";
        progressFill.textContent = progress + "%";
      } else clearInterval(interval);
    }, 80);
  </script>
</body>
</html>

